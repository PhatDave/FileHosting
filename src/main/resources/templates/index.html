<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<script crossorigin="anonymous"
	        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
	        src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<link crossorigin="anonymous"
	      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
	      rel="stylesheet">
	<script crossorigin="anonymous"
	        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
	        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

	<link rel="stylesheet"
	      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css">
	</link>
	<link rel="stylesheet"
	      src=" https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
	</link>
	<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

	<script crossorigin="anonymous"
	        src="https://kit.fontawesome.com/3c7df30b74.js"></script>

	<script crossorigin="anonymous"
	        integrity="sha256-xH4q8N0pEzrZMaRmd7gQVcTZiFei+HfRTBPJ1OGXC0k="
	        src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
	<title>Cyka uploads</title>
	<style>
		.ui-progressbar-value {
			background-color: deepskyblue;
		}

		.ui-progressbar-complete {
			background-color: darkblue;
		}

		#pBar {
			background-color: rgba(0, 0, 0, 0);
		}

		#pBarText {
			background-color: rgba(0, 0, 0, 0);
		}
	</style>
</head>
<body>
<div th:if="${message}">
	<h2 th:text="${message}"/>
</div>

<div>
	<form action="/" enctype="multipart/form-data" id="target" method="POST">
		<div class="row">
			<input id="file"
			       multiple
			       name="file"
			       style="width: 100%; height: 20em; border: 3px solid black"
			       type="file"/>
		</div>
	</form>
</div>

<div class="d-flex justify-content-center" id="pBarText"></div>
<div class="row" id="pBar" style="height: 25px; border: 1px solid blue">
</div>

<div class="table-responsive col-md-10 mt-3 mb-5 mx-auto">
	<table class="table" id="datatable">
		<thead>
		<tr>
			<th>Name</th>
			<th></th>
			<th></th>
		</tr>
		</thead>
	</table>

	<script>
		$(document).ready(function() {
			let dataTableDOM = $('#datatable');
			let dataTable = dataTableDOM.DataTable({
				ajax: {
					url: '/api/files/',
					dataSrc: '',
				},
				columns: [
					{data: "name"},
					{
						data: null,
						className: "dt-center text-center py-2 editor-download",
						defaultContent: '<i class="fa-solid fa-download"></i>',
						orderable: false
					},
					{
						data: null,
						className: "dt-center text-center py-2 editor-delete",
						defaultContent: '<i class="fa fa-trash"/>',
						orderable: false
					},
				],
			});

			dataTableDOM.on('click', 'td.editor-delete', function(e) {
				e.preventDefault();

				let row = dataTable.row($(this).closest('tr'));
				let fileName = row.data().name;

				$.ajax({
					url: "/api/files/" + fileName,
					type: "DELETE",
					success: function() {
						row.remove().draw();
					}
				})
			});

			dataTableDOM.on('click', 'td.editor-download', function(e) {
				e.preventDefault();

				let row = dataTable.row($(this).closest('tr'));
				let fileName = row.data().name;

				window.location.href = "/files/" + fileName;
			});
		})
	</script>
</div>

<script th:src="@{/js/main.js}"></script>
</body>
</html>